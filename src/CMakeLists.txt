CMAKE_MINIMUM_REQUIRED(VERSION 3.1)
PROJECT(kyla)
SET_PROPERTY(GLOBAL PROPERTY USE_FOLDERS ON)
ENABLE_TESTING()

SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY 	${PROJECT_BINARY_DIR}/bin)
SET(CMAKE_RUNTIME_OUTPUT_DIRECTORY 	${PROJECT_BINARY_DIR}/bin)
SET(CMAKE_ARCHIVE_OUTPUT_DIRECTORY 	${PROJECT_BINARY_DIR}/bin)

ADD_SUBDIRECTORY(base)
ADD_SUBDIRECTORY(kyla)
ADD_SUBDIRECTORY(cli)

ADD_SUBDIRECTORY(extern)
ADD_SUBDIRECTORY(util)

ADD_SUBDIRECTORY(ui)

find_package(PythonInterp)

ADD_CUSTOM_TARGET (docs
    ${PYTHON_EXECUTABLE} -m venv env
    COMMAND env/scripts/activate.bat
    COMMAND python -m pip install -q --upgrade pip
    COMMAND pip install -q -U Sphinx sphinx_rtd_theme
    COMMAND make.bat html

    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/../doc)

ADD_CUSTOM_TARGET (deploy
    ${PYTHON_EXECUTABLE}
    ${CMAKE_CURRENT_SOURCE_DIR}/../samples/gen-sdk.py
    ${CMAKE_CURRENT_SOURCE_DIR}/..
    $<TARGET_FILE:kcl>
    WORKING_DIRECTORY ${PROJECT_BINARY_DIR})

ADD_DEPENDENCIES(deploy docs kui)

ADD_TEST(NAME SanityTests
	COMMAND	${PYTHON_EXECUTABLE} ${CMAKE_CURRENT_SOURCE_DIR}/../test/testrunner.py
		$<TARGET_FILE:kcl>
    WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/../test)
